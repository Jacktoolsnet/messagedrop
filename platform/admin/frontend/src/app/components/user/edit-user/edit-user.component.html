<div class="dialog-wrap">
  <div class="dialog-header">
    <div class="avatar">
      <mat-icon>manage_accounts</mat-icon>
    </div>
    <div class="titles">
      <h2>Edit User</h2>
      @if (!isSelf) {
        <p>Change user details</p>
      }
      @if (isSelf) {
        <p>Change your password</p>
      }
    </div>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="edit-user-form">
    <!-- Username (nur Admin/Root) -->
    @if (canChangeUsername) {
      <mat-form-field appearance="outline" class="full">
        <mat-label>Username</mat-label>
        <input matInput formControlName="username" />
        @if (form.controls.username.invalid) {
          <mat-error>Username is required (min 3 chars)</mat-error>
        }
      </mat-form-field>
    }

    <!-- Password (immer sichtbar: Admin/Root kÃ¶nnen auch PW setzen; normale User nur ihr eigenes) -->
    <mat-form-field appearance="outline" class="full">
      <mat-label>New Password (optional)</mat-label>
      <input matInput type="password" formControlName="password" />
    </mat-form-field>

    <!-- Rolle (nur Admin/Root) -->
    @if (canChangeRole) {
      <mat-form-field appearance="outline" class="full">
        <mat-label>Role</mat-label>
        <mat-select formControlName="role">
          <mat-option value="moderator">Moderator</mat-option>
          <mat-option value="moderator">Legal</mat-option>
          <mat-option value="admin">Admin</mat-option>
        </mat-select>
      </mat-form-field>
    }

    <div class="dialog-actions">
      <button type="button" mat-stroked-button (click)="cancel()">Cancel</button>
      <button type="submit" mat-raised-button color="primary" [disabled]="form.invalid">Save</button>
    </div>
  </form>
</div>