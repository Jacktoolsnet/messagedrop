<mat-toolbar>
    <button mat-icon-button routerLink="/dashboard/dsa" aria-label="DSA Home">
        <mat-icon>arrow_back</mat-icon>
    </button>

    <span class="toolbar-title">Signals</span>

    <button mat-stroked-button (click)="reload()">
        <mat-icon>refresh</mat-icon>
        Refresh
    </button>
</mat-toolbar>

@if (loading()) {
<mat-progress-bar mode="indeterminate"></mat-progress-bar>
}

<div class="page">
    <!-- Filter -->
    <div class="filter-row">
        <mat-form-field appearance="outline">
            <mat-label>Type</mat-label>
            <mat-select [formControl]="filterForm.controls.type">
                <mat-option value="">All</mat-option>
                <mat-option value="public_message">Public message</mat-option>
                <mat-option value="comment">Comment</mat-option>
                <mat-option value="profile">Profile</mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Category</mat-label>
            <input matInput [formControl]="filterForm.controls.category" placeholder="e.g. hate, privacy" />
        </mat-form-field>

        <mat-form-field class="grow" appearance="outline">
            <mat-label>Search</mat-label>
            <input matInput [formControl]="filterForm.controls.q" placeholder="reason, contentId …" />
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Range</mat-label>
            <mat-select [formControl]="filterForm.controls.range">
                <mat-option value="24h">Last 24h</mat-option>
                <mat-option value="7d">Last 7 days</mat-option>
                <mat-option value="30d">Last 30 days</mat-option>
                <mat-option value="all">All</mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <!-- Liste -->
    <div class="tiles-container">
        @for (s of signals(); track trackById($index, s)) {
        <mat-card class="tile">
            <mat-card-header>
                <div mat-card-avatar class="avatar" [matBadge]="isNew(s) ? 'new' : ''" [matBadgeHidden]="!isNew(s)">
                    <mat-icon>info</mat-icon>
                </div>
                <mat-card-title class="tile-title">
                    {{ s.reportedContentType }}
                </mat-card-title>
                <mat-card-subtitle class="tile-subtitle">
                    {{ s.category || 'uncategorized' }} • {{ s.createdAt | date: 'medium' }}
                </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
                <div class="meta-row">
                    <span class="meta">
                        <mat-icon>fingerprint</mat-icon>
                        {{ s.contentId }}
                    </span>

                    @if (s.contentUrl) {
                    <a [href]="s.contentUrl" target="_blank" rel="noopener">
                        <mat-icon>open_in_new</mat-icon>
                        Open content
                    </a>
                    }
                </div>

                @if (s.reasonText) {
                <div class="reason">{{ s.reasonText }}</div>
                }
            </mat-card-content>

            <mat-card-actions align="end">
                <button mat-stroked-button (click)="openDetail(s)">
                    <mat-icon>visibility</mat-icon>
                    Details
                </button>
                <button mat-raised-button color="warn" (click)="dismiss(s)">
                    <mat-icon>delete</mat-icon>
                    Dismiss
                </button>
                <button mat-raised-button color="primary" (click)="promote(s)">
                    <mat-icon>upgrade</mat-icon>
                    Promote
                </button>
            </mat-card-actions>
        </mat-card>
        }
    </div>

    <!-- Empty State -->
    @if (!loading() && signals().length === 0) {
    <div class="empty-state">
        <mat-icon>inbox</mat-icon>
        <div>No signals for the selected filters.</div>
    </div>
    }
</div>