<div class="searchTerm-container">
  <input type="search"
    enterkeyhint="search"
    [placeholder]="'common.hashtagSearch.placeholder' | transloco"
    [(ngModel)]="query"
    (keyup.enter)="search()" />
  <button type="button" (click)="search()" [attr.aria-label]="'common.hashtagSearch.searchAction' | transloco">
    <mat-icon>search</mat-icon>
  </button>
</div>

<mat-dialog-content class="hashtag-search-content">
  @if (errorText()) {
  <p class="state-line state-line--error">{{ errorText() }}</p>
  }

  @if (loadingPublic()) {
  <p class="state-line">{{ 'common.hashtagSearch.searching' | transloco }}</p>
  }

  @if (hasSearched() && !loadingPublic() && !hasAnyResult() && !errorText()) {
  <p class="state-line">{{ 'common.hashtagSearch.noResults' | transloco }}</p>
  }

  @if (viewMode === 'map') {
  <app-hashtag-results-map [items]="mapItems()" [initialCenter]="mapView.center" [initialZoom]="mapView.zoom"
    [selectedItemId]="selectedMapItemId()" (itemSelected)="onMapItemSelected($event)"
    (viewChange)="onViewChange($event)">
  </app-hashtag-results-map>
  } @else {
  <div class="results-list">
    @if (localPlaceResults().length > 0) {
    <section class="result-section">
      <h3>{{ 'common.hashtagSearch.sections.places' | transloco }}</h3>
      @for (place of localPlaceResults(); track place.id) {
      <button mat-stroked-button type="button" class="result-button" (click)="selectPlace(place)">
        <mat-icon>place</mat-icon>
        <span class="result-main">{{ place.name || ('common.placeList.nameFallback' | transloco) }}</span>
        @if (place.hashtags?.length) {
        <span class="result-tags">{{ hashtagsLabel(place.hashtags) }}</span>
        }
      </button>
      }
    </section>
    }

    @if (localContactResults().length > 0) {
    <section class="result-section">
      <h3>{{ 'common.hashtagSearch.sections.contacts' | transloco }}</h3>
      @for (contact of localContactResults(); track contact.id) {
      <button mat-stroked-button type="button" class="result-button" (click)="selectContact(contact)">
        <mat-icon>contacts</mat-icon>
        <span class="result-main">{{ contact.name || ('common.contact.list.nameFallback' | transloco) }}</span>
        @if (contact.hashtags?.length) {
        <span class="result-tags">{{ hashtagsLabel(contact.hashtags) }}</span>
        }
      </button>
      }
    </section>
    }

    @if (localExperienceResults().length > 0) {
    <section class="result-section">
      <h3>{{ 'common.hashtagSearch.sections.experiences' | transloco }}</h3>
      @for (experience of localExperienceResults(); track experience.productCode) {
      <button mat-stroked-button type="button" class="result-button" (click)="selectExperience(experience)">
        <mat-icon>bookmark_star</mat-icon>
        <span class="result-main">{{ experience.snapshot.title || experience.productCode }}</span>
        @if (experience.hashtags?.length) {
        <span class="result-tags">{{ hashtagsLabel(experience.hashtags) }}</span>
        }
      </button>
      }
    </section>
    }

    @if (publicMessages().length > 0) {
    <section class="result-section">
      <h3>{{ 'common.hashtagSearch.sections.publicMessages' | transloco }}</h3>
      @for (message of publicMessages(); track message.uuid) {
      <button mat-stroked-button type="button" class="result-button result-button--message" (click)="selectMessage(message)">
        <mat-icon>forum</mat-icon>
        <span class="result-main">{{ getPublicPreview(message) }}</span>
        @if (message.hashtags?.length) {
        <span class="result-tags">{{ hashtagsLabel(message.hashtags) }}</span>
        }
      </button>
      }
    </section>
    }

    @if (publicComments().length > 0) {
    <section class="result-section">
      <h3>{{ 'common.hashtagSearch.sections.comments' | transloco }}</h3>
      @for (message of publicComments(); track message.uuid) {
      <button mat-stroked-button type="button" class="result-button result-button--message" (click)="selectMessage(message)">
        <mat-icon>chat</mat-icon>
        <span class="result-main">{{ getPublicPreview(message) }}</span>
        @if (message.hashtags?.length) {
        <span class="result-tags">{{ hashtagsLabel(message.hashtags) }}</span>
        }
      </button>
      }
    </section>
    }
  </div>
  }
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
  <button mat-dialog-close mat-icon-button class="action-close"
    [attr.aria-label]="'common.actions.abort' | transloco">
    <mat-icon>close</mat-icon>
  </button>
  <button mat-icon-button type="button" (click)="help.open(helpTopic)"
    [attr.aria-label]="'common.actions.help' | transloco">
    <mat-icon>help</mat-icon>
  </button>
  <button mat-icon-button type="button" (click)="toggleViewMode()"
    [attr.aria-label]="viewMode === 'list' ? ('common.location.switchToMap' | transloco) : ('common.location.switchToList' | transloco)">
    <mat-icon>{{ viewMode === 'list' ? 'map' : 'list' }}</mat-icon>
  </button>
</mat-dialog-actions>
