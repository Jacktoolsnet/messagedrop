<mat-dialog-content class="experience-dialog-content">
  <div class="experience-scroll">
    <div class="search-bar">
      <input type="search" enterkeyhint="search" [formControl]="form.controls.term" (keyup.enter)="onSearch()"
        [placeholder]="'common.experiences.searchPlaceholder' | transloco" />
      <button type="button" class="filter-button" [matMenuTriggerFor]="filterMenu"
        [attr.aria-label]="'common.actions.more' | transloco">
        <mat-icon>tune</mat-icon>
      </button>
      <button type="button" class="sort-button" [matMenuTriggerFor]="sortMenu"
        [attr.aria-label]="'common.experiences.sort' | transloco">
        <mat-icon>sort</mat-icon>
      </button>
      <button type="button" class="search-button" (click)="onSearch()" [disabled]="loading() || !canSearch()"
        [attr.aria-label]="'common.experiences.search' | transloco">
        <mat-icon>search</mat-icon>
      </button>
    </div>
    <mat-menu #sortMenu="matMenu">
      <div class="sort-menu-content">
        <mat-radio-group class="sort-menu-group" [formControl]="form.controls.sort">
          @for (option of sortOptions; track option.value) {
            <mat-radio-button [value]="option.value">{{ option.labelKey | transloco }}</mat-radio-button>
          }
        </mat-radio-group>
      </div>
    </mat-menu>
    <mat-menu #filterMenu="matMenu">
      <div class="filter-menu-content" (click)="$event.stopPropagation()">
        <div class="filters">
          <mat-form-field appearance="outline">
            <mat-label>{{ 'common.experiences.dateFrom' | transloco }}</mat-label>
            <input matInput type="date" [formControl]="form.controls.startDate" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'common.experiences.dateTo' | transloco }}</mat-label>
            <input matInput type="date" [formControl]="form.controls.endDate" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'common.experiences.minPrice' | transloco }}</mat-label>
            <input matInput type="number" min="0" [formControl]="form.controls.minPrice" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'common.experiences.maxPrice' | transloco }}</mat-label>
            <input matInput type="number" min="0" [formControl]="form.controls.maxPrice" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'common.experiences.minDuration' | transloco }}</mat-label>
            <input matInput type="number" min="0" [formControl]="form.controls.minDurationHours" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'common.experiences.maxDuration' | transloco }}</mat-label>
            <input matInput type="number" min="0" [formControl]="form.controls.maxDurationHours" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'common.experiences.currency' | transloco }}</mat-label>
            <input matInput type="text" [formControl]="form.controls.currency" />
          </mat-form-field>
        </div>

        <div class="filters-actions">
          <button mat-stroked-button type="button" (click)="onReset()" [disabled]="loading()">
            {{ 'common.experiences.reset' | transloco }}
          </button>
        </div>
      </div>
    </mat-menu>

    <section class="results-panel">
      @if (viewMode() === 'map') {
        <app-search-settings-map-preview class="map-preview-full" [center]="worldCenter" [zoom]="3">
        </app-search-settings-map-preview>
      }

      @if (viewMode() === 'list') {
        <div class="results" role="list">
          @for (result of results(); track result.trackId) {
            <article class="result-card" role="listitem" [class.result-card--selected]="selectedResult()?.trackId === result.trackId">
              @if (result.imageUrl) {
                <img class="result-image" [src]="result.imageUrl" [alt]="result.title || result.productCode || ''" />
              }
              <div class="result-content">
                <div class="result-header">
                  <h3 class="result-title">{{ result.title || result.productCode }}</h3>
                  @if (result.duration) {
                    <span class="result-duration">{{ result.duration }}</span>
                  }
                </div>
                @if (result.description) {
                  <p class="result-description">{{ result.description }}</p>
                }
                <div class="result-meta">
                  @if (getRatingLabel(result)) {
                    <span class="meta-item">â˜… {{ getRatingLabel(result) }}</span>
                  }
                  @if (getPriceLabel(result)) {
                    <span class="meta-item">{{ getPriceLabel(result) }}</span>
                  }
                </div>
                <div class="result-actions">
                  <button mat-stroked-button type="button" (click)="onOpen(result)" [disabled]="!result.productUrl"
                    [attr.aria-label]="'common.experiences.openOn' | transloco : { provider: 'Viator' }">
                    {{ 'common.experiences.openOn' | transloco : { provider: 'Viator' } }}
                  </button>
                  <button mat-flat-button color="primary" type="button" (click)="onSelect(result)">
                    {{ 'common.experiences.select' | transloco }}
                  </button>
                </div>
              </div>
            </article>
          }
        </div>

        @if (canLoadMore()) {
          <div class="load-more">
            <button mat-stroked-button type="button" (click)="onLoadMore()">
              {{ 'common.experiences.loadMore' | transloco }}
            </button>
          </div>
        }
      }
    </section>
  </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
  <button mat-dialog-close mat-icon-button class="action-close"
    [attr.aria-label]="'common.actions.abort' | transloco">
    <mat-icon>close</mat-icon>
  </button>
  <button mat-icon-button type="button" (click)="help.open('experienceSearch')"
    [attr.aria-label]="'common.actions.help' | transloco">
    <mat-icon>help</mat-icon>
  </button>
  <button mat-icon-button type="button" (click)="toggleViewMode()"
    [attr.aria-label]="viewMode() === 'list' ? ('common.location.switchToMap' | transloco) : ('common.location.switchToList' | transloco)">
    <mat-icon>{{ viewMode() === 'list' ? 'map' : 'list' }}</mat-icon>
  </button>
  <button mat-icon-button color="primary" type="button" (click)="onApply()" [disabled]="!selectedResult()"
    [attr.aria-label]="'common.actions.apply' | transloco">
    <mat-icon>check</mat-icon>
  </button>
</mat-dialog-actions>
