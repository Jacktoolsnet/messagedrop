<app-dialog-header
  icon="local_activity"
  [title]="data.result.title || data.result.productCode || ''"
  [subtitle]="getDurationLabel() ? (('common.experiences.durationPrefix' | transloco) + ' ' + getDurationLabel()) : ''">
</app-dialog-header>

<mat-dialog-content class="detail-dialog-content">

  <div class="detail-scroll">

    <div class="detail-hero" [style.--detail-hero-bg-image]="getExperienceHeaderBackgroundImage()"
      [style.--detail-hero-bg-opacity]="getExperienceHeaderBackgroundOpacity()">
      <div class="viator-badge">
        <span class="viator-badge__text">{{ 'common.experiences.sourceViator' | transloco }}</span>
        <a class="viator-badge__link" href="https://www.viator.com/?pid=P00285785&mcid=42383&medium=link"
          target="_blank" rel="noopener">
          Viator
        </a>
      </div>
      @if (getRatingLabel()) {
      <div class="rating-badge">â˜… {{ getRatingLabel() }}</div>
      }
    </div>

    <mat-card class="detail-tile">
      <div class="detail-tile__header">
        <div class="detail-tile__header-left">
          <mat-icon>description</mat-icon>
          <span class="detail-tile__title">{{ 'common.experiences.description' | transloco }}</span>
        </div>
      </div>
      <mat-card-content class="detail-body">
        <p class="detail-description">
          {{ detail()?.description || data.result.description }}
        </p>
      </mat-card-content>
    </mat-card>

    @if (sameStartEnd() && getCombinedPointItems().length) {
      <mat-card class="detail-tile">
        <div class="detail-tile__header">
          <div class="detail-tile__header-left">
            <img class="detail-tile__icon" src="assets/markers/experience-start-marker.svg" alt="" />
            <span class="detail-tile__title">{{ 'common.experiences.startEndPoint' | transloco }}</span>
          </div>
          @if (getFirstMappableItem(getCombinedPointItems()); as mapItem) {
            <button mat-icon-button class="detail-tile__header-action" type="button" (click)="openMaps(mapItem)">
              <mat-icon>assistant_direction</mat-icon>
            </button>
          }
        </div>
        <mat-card-content class="detail-tile__body">
          <div class="detail-section__body">
            @for (item of getCombinedPointItems(); track item.ref) {
              <div class="detail-location">
                <div class="detail-location__title">
                  {{ item.name || (item.address ? item.address : ('common.experiences.locationUnavailable' | transloco)) }}
                </div>
                @if (item.address) {
                  <div class="detail-location__address">{{ item.address }}</div>
                }
                @if (item.description) {
                  <div class="detail-location__desc">{{ item.description }}</div>
                }
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>
    } @else {
      @if (startItems().length) {
        <mat-card class="detail-tile">
          <div class="detail-tile__header">
            <div class="detail-tile__header-left">
              <img class="detail-tile__icon" src="assets/markers/experience-start-marker.svg" alt="" />
              <span class="detail-tile__title">{{ 'common.experiences.startPoint' | transloco }}</span>
            </div>
            @if (getFirstMappableItem(startItems()); as mapItem) {
              <button mat-icon-button class="detail-tile__header-action" type="button" (click)="openMaps(mapItem)">
                <mat-icon>assistant_direction</mat-icon>
              </button>
            }
          </div>
          <mat-card-content class="detail-tile__body">
            <div class="detail-section__body">
              @for (item of startItems(); track item.ref) {
                <div class="detail-location">
                  <div class="detail-location__title">
                    {{ item.name || (item.address ? item.address : ('common.experiences.locationUnavailable' | transloco)) }}
                  </div>
                  @if (item.address) {
                    <div class="detail-location__address">{{ item.address }}</div>
                  }
                  @if (item.description) {
                    <div class="detail-location__desc">{{ item.description }}</div>
                  }
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }

      @if (endItems().length) {
        <mat-card class="detail-tile">
          <div class="detail-tile__header">
            <div class="detail-tile__header-left">
              <img class="detail-tile__icon" src="assets/markers/experience-stop-marker.svg" alt="" />
              <span class="detail-tile__title">{{ 'common.experiences.endPoint' | transloco }}</span>
            </div>
            @if (getFirstMappableItem(endItems()); as mapItem) {
              <button mat-icon-button class="detail-tile__header-action" type="button" (click)="openMaps(mapItem)">
                <mat-icon>assistant_direction</mat-icon>
              </button>
            }
          </div>
          <mat-card-content class="detail-tile__body">
            <div class="detail-section__body">
              @for (item of endItems(); track item.ref) {
                <div class="detail-location">
                  <div class="detail-location__title">
                    {{ item.name || (item.address ? item.address : ('common.experiences.locationUnavailable' | transloco)) }}
                  </div>
                  @if (item.address) {
                    <div class="detail-location__address">{{ item.address }}</div>
                  }
                  @if (item.description) {
                    <div class="detail-location__desc">{{ item.description }}</div>
                  }
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }
    }

    @if (redemptionItems().length) {
    <mat-card class="detail-tile">
      <div class="detail-tile__header">
        <div class="detail-tile__header-left">
          <mat-icon>confirmation_number</mat-icon>
          <span class="detail-tile__title">{{ 'common.experiences.redemptionPoint' | transloco }}</span>
        </div>
        @if (getFirstMappableItem(redemptionItems()); as mapItem) {
          <button mat-icon-button class="detail-tile__header-action" type="button" (click)="openMaps(mapItem)">
            <mat-icon>assistant_direction</mat-icon>
          </button>
        }
      </div>
      <mat-card-content class="detail-tile__body">
        <div class="detail-section__body">
          @for (item of redemptionItems(); track item.ref) {
          <div class="detail-location">
            <div class="detail-location__title">
              {{ item.name || (item.address ? item.address : ('common.experiences.locationUnavailable' | transloco)) }}
            </div>
            @if (item.address) {
            <div class="detail-location__address">{{ item.address }}</div>
            }
            @if (item.description) {
            <div class="detail-location__desc">{{ item.description }}</div>
            }
          </div>
          }
        </div>
      </mat-card-content>
    </mat-card>
    }

    @if (pickupItems().length) {
    <mat-card class="detail-tile">
      <div class="detail-tile__header">
        <div class="detail-tile__header-left">
          <mat-icon>place</mat-icon>
          <span class="detail-tile__title">{{ 'common.experiences.pickupPoint' | transloco }}</span>
        </div>
        @if (getFirstMappableItem(pickupItems()); as mapItem) {
          <button mat-icon-button class="detail-tile__header-action" type="button" (click)="openMaps(mapItem)">
            <mat-icon>assistant_direction</mat-icon>
          </button>
        }
      </div>
      <mat-card-content class="detail-tile__body">
        <div class="detail-section__body">
          @for (item of pickupItems(); track item.ref) {
          <div class="detail-location">
            <div class="detail-location__title">
              {{ item.name || (item.address ? item.address : ('common.experiences.locationUnavailable' | transloco)) }}
            </div>
            @if (item.address) {
            <div class="detail-location__address">{{ item.address }}</div>
            }
            @if (item.description) {
            <div class="detail-location__desc">{{ item.description }}</div>
            }
          </div>
          }
        </div>
      </mat-card-content>
    </mat-card>
    }

    @if (mapMarkers().length) {
    <mat-card class="detail-tile">
      <div class="detail-tile__header">
        <mat-icon>map</mat-icon>
        <span class="detail-tile__title">{{ 'common.experiences.map' | transloco }}</span>
      </div>
      <mat-card-content class="detail-tile__body">
        <app-search-settings-map-preview class="detail-map" [center]="mapCenter()" [zoom]="9" [markers]="mapMarkers()"
          [fitMarkers]="true" [fitMaxZoom]="14" [interactive]="true"
          [markerIconUrl]="'assets/markers/experience-marker.svg'">
        </app-search-settings-map-preview>
      </mat-card-content>
    </mat-card>
    }
  </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
  <button mat-dialog-close mat-icon-button class="action-close" [attr.aria-label]="'common.actions.abort' | transloco">
    <mat-icon>close</mat-icon>
  </button>
  <button mat-icon-button type="button" (click)="help.open('experienceSearch')"
    [attr.aria-label]="'common.actions.help' | transloco">
    <mat-icon>help</mat-icon>
  </button>
  <button mat-stroked-button class="open-viator-button" type="button" (click)="onOpen()"
    [disabled]="!data.result.productUrl"
    [attr.aria-label]="'common.experiences.openOn' | transloco : { provider: 'Viator' }">
    <mat-icon>shopping_cart</mat-icon>
    <span class="open-viator-label">
      {{ getPriceLabel() || ('common.experiences.openOn' | transloco : { provider: 'Viator' }) }}
    </span>
  </button>
</mat-dialog-actions>
