<mat-dialog-content class="audio-recorder">
  <div class="audio-recorder__header">
    <mat-icon>mic</mat-icon>
    <span>{{ 'common.audioRecorder.title' | transloco }}</span>
    @if (recording) {
    <span class="audio-recorder__timer" aria-live="polite">
      <mat-icon>schedule</mat-icon>
      <span>{{ remainingLabel() }}</span>
    </span>
    }
    @if (!recording && playbackActive) {
    <span class="audio-recorder__timer" aria-live="polite">
      <mat-icon>hourglass_bottom</mat-icon>
      <span>{{ playbackLabel() }}</span>
    </span>
    }
  </div>

  <div class="audio-recorder__wave">
    @if (audioPayload?.waveform?.length) {
    @if (getPlaybackBars(); as playbackBars) {
    <div class="audio-recorder__bars">
      @for (bar of playbackBars; track $index) {
      <span class="audio-recorder__bar"
        [style.transform]="'scaleY(' + bar.value + ')'"
        [class.audio-recorder__bar--active]="bar.active"></span>
      }
    </div>
    }
    } @else if (liveWaveform.length) {
    <div class="audio-recorder__bars">
      @for (bar of liveWaveform; track $index) {
      <span class="audio-recorder__bar"
        [style.transform]="'scaleY(' + (bar ?? 0.2) + ')'"
      ></span>
      }
    </div>
    } @else {
    <div class="audio-recorder__wave-bars"></div>
    }
  </div>

  @if (errorMessage && !isTooLarge) {
  <div class="audio-recorder__error">
    {{ errorMessage | transloco }}
  </div>
  }

  @if (isTooLarge) {
  <div class="audio-recorder__error">
    {{ 'common.audioRecorder.tooLarge' | transloco:{ maxMb: (maxBase64Bytes / 1_000_000) } }}
  </div>
  }

  <div class="audio-recorder__controls" aria-hidden="true"></div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
  <div class="audio-recorder__actionbar audio-recorder__actionbar--left">
    <button mat-icon-button type="button" (click)="cancel()" [attr.aria-label]="'common.actions.abort' | transloco">
      <mat-icon>close</mat-icon>
    </button>
    <button mat-icon-button type="button" (click)="openHelp()"
      [attr.aria-label]="'common.actions.help' | transloco">
      <mat-icon>help</mat-icon>
    </button>
  </div>

  <div class="audio-recorder__actionbar audio-recorder__actionbar--right">
    <button mat-icon-button type="button" (click)="toggleRecording()"
      [attr.aria-label]="recording ? ('common.audioRecorder.stop' | transloco) : ('common.audioRecorder.record' | transloco)">
      <mat-icon>{{ recording ? 'mic_off' : 'mic' }}</mat-icon>
    </button>

    <button mat-icon-button type="button" (click)="togglePlayback()" [disabled]="!hasAudio"
      [attr.aria-label]="isPlaying() ? ('common.audioRecorder.pause' | transloco) : ('common.audioRecorder.play' | transloco)">
      <mat-icon>{{ isPlaying() ? 'pause' : 'play_arrow' }}</mat-icon>
    </button>

    <button mat-icon-button type="button" (click)="resetAudio()" [disabled]="!hasAudio && !isTooLarge"
      [attr.aria-label]="'common.audioRecorder.retry' | transloco">
      <mat-icon>delete</mat-icon>
    </button>

    <button mat-icon-button color="primary" type="button" (click)="send()" [disabled]="!hasAudio || isTooLarge"
      [attr.aria-label]="'common.audioRecorder.send' | transloco">
      <mat-icon>send</mat-icon>
    </button>
  </div>
</mat-dialog-actions>
