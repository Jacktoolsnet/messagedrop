<h2 mat-dialog-title class="dialog-title">
  <span class="dialog-title__text">
    @if (locationName$ | async; as locationName) {
      {{ 'weather.titleForLocation' | transloco: { location: locationName } }}
    } @else {
      {{ 'weather.title' | transloco }}
    }
  </span>
</h2>

<mat-dialog-content #dialogContent class="weather-dialog-content">
  <div class="weather-scroll">
  @if (weatherSig(); as weather) {

    <!-- Day Switch -->
    <mat-button-toggle-group [hideSingleSelectionIndicator]="true" class="day-toggle-group" [value]="selectedDayIndex"
      (change)="onDayChange($event.value)">
      @for (day of weather.daily; track day; let i = $index) {
        <mat-button-toggle [value]="i">
          {{ getDayLabel(i) }}
        </mat-button-toggle>
      }
    </mat-button-toggle-group>

    <!-- TILE GRID -->
    @if (!selectedTile) {
      <div class="tile-grid">
        @for (tile of tiles(); track tile.type) {
          <button type="button" class="tile" (click)="onTileClick(tile)" [style.color]="tile.color">
            <div class="tile-title">{{ tile.label }}</div>
            <div class="tile-icon-wrapper">
              <mat-icon class="material-symbols-outlined tile-icon">{{ tile.icon }}</mat-icon>
            </div>
            <div class="tile-value">{{ tile.value }}</div>
            @if (tile.levelText) {
              <div class="tile-level">{{ tile.levelText }}</div>
            }
            @if (tile.minMax) {
              <div class="tile-minmax">{{ tile.minMax.min }} - {{ tile.minMax.max }}</div>
            }
          </button>
        }
      </div>
    }

    <!-- CHART VIEW -->
    @if (selectedTile) {
      <app-weather-detail [tile]="selectedTile" [weather]="weather" [selectedDayIndex]="selectedDayIndex"
        [selectedHour]="selectedHour">
      </app-weather-detail>
    }

    <!-- SLIDER -->
    <div class="hour-slider">
      <mat-slider min="0" max="23" step="1" thumbLabel tickInterval="1" (input)="onHourChange()">
        <input matSliderThumb [(ngModel)]="selectedHour" />
      </mat-slider>
      @if (!selectedTile) {
        <div class="selected-hour">{{ 'weather.selectedHour' | transloco: { hour: selectedHour } }}</div>
      }
    </div>

    <!-- TILE NAVIGATION BUTTONS -->
    @if (selectedTile) {
      <div class="tile-nav-buttons">
        <button mat-mini-fab color="accent" (click)="selectPreviousTile()" [disabled]="tileIndex === 0">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button mat-mini-fab color="primary" (click)="selectedTile = null">
          <mat-icon>close</mat-icon>
        </button>
        <button mat-mini-fab color="accent" (click)="selectNextTile()" [disabled]="tileIndex === tiles().length - 1">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    }
  }

  <!-- DATA SOURCE -->
  <div class="data-source">
    {{ 'weather.dataSource' | transloco }}
    <a href="https://open-meteo.com/" target="_blank" rel="noopener">open-meteo.com</a>.
  </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
  <button mat-dialog-close mat-icon-button class="action-close" cdkFocusInitial
    [attr.aria-label]="'common.actions.close' | transloco">
    <mat-icon>close</mat-icon>
  </button>
</mat-dialog-actions>
