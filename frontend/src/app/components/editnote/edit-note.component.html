<app-dialog-header
  icon="{{ headerConfig.icon }}"
  [title]="headerConfig.labelKey | transloco">
</app-dialog-header>

<mat-dialog-content>
    <div class="content">

        @if (data.note.multimedia.type === 'undefined') {
        <app-select-multimedia class="oembed_container" (newMultimedia)="applyNewMultimedia($event)">
        </app-select-multimedia>
        } @else if (data.note.multimedia.type === 'tenor') {
        <div class="oembed_container">
            <button mat-mini-fab color="primary" class="button_remove_multimedia" (click)="removeMultimedia()">
                <mat-icon>delete</mat-icon>
            </button>
            <app-showmultimedia class="oembed_container" [multimedia]="data.note.multimedia">
                <button mat-mini-fab color="primary" class="button_remove_multimedia" (click)="removeMultimedia()">
                    <mat-icon>delete</mat-icon>
                </button>
            </app-showmultimedia>
        </div>
        }

        @if (data.note.note === '') {
        <div class="oembed_container">
            <button (click)="openTextDialog()" mat-flat-button class="button_default" color="primary">
                <span>{{ 'common.note.addText' | transloco }}</span>
            </button>
        </div>
        } @else {
        <div class="text_container">
            <button mat-mini-fab class="button_random" color="secondary"
                [attr.aria-label]="'common.actions.randomizeStyle' | transloco" (click)="onNewFontClick()">
                <mat-icon>cycle</mat-icon>
            </button>
            <button mat-mini-fab color="primary" class="button_remove_text" (click)="removeText()">
                <mat-icon>delete</mat-icon>
            </button>
            <p class="text" role="button" tabindex="0" (click)="openTextDialog()" (keyup.enter)="openTextDialog()"
                (keyup.space)="openTextDialog()" [style]="data.note.style">{{ data.note.note }}</p>
        </div>
        }

        <div class="hashtag_container">
            <mat-form-field appearance="outline" class="full-width hashtag-field">
                <mat-label>{{ 'common.hashtags.label' | transloco }}</mat-label>
                <mat-chip-grid #hashtagChipGrid aria-label="Hashtags">
                    @for (tag of hashtagTags; track tag) {
                    <mat-chip-row (removed)="removeHashtag(tag)">
                        #{{ tag }}
                        <button matChipRemove type="button" [attr.aria-label]="'common.actions.delete' | transloco">
                            <mat-icon>cancel</mat-icon>
                        </button>
                    </mat-chip-row>
                    }
                    <input
                        matInput
                        [matChipInputFor]="hashtagChipGrid"
                        [matAutocomplete]="hashtagAutocomplete"
                        [placeholder]="'common.hashtags.placeholder' | transloco"
                        [(ngModel)]="hashtagInput"
                        (keydown.enter)="onHashtagEnter($event)" />
                </mat-chip-grid>
                <mat-autocomplete #hashtagAutocomplete="matAutocomplete"
                    (optionSelected)="onHashtagSuggestionSelected($event.option.value)">
                    @for (suggestion of getHashtagSuggestions(); track suggestion) {
                    <mat-option [value]="suggestion">#{{ suggestion }}</mat-option>
                    }
                </mat-autocomplete>
                <button mat-icon-button matSuffix type="button" (click)="onAddHashtagClick()"
                    [attr.aria-label]="'common.actions.apply' | transloco">
                    <mat-icon>add</mat-icon>
                </button>
                <mat-hint>{{ 'common.hashtags.publicHint' | transloco : { max: maxLocalHashtags } }}</mat-hint>
            </mat-form-field>
        </div>

        @if (isLocationEditable) {
        <app-location-picker-tile [location]="data.note.location" markerType="note"
            (locationChange)="updateLocation($event)"></app-location-picker-tile>
        }

    </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
    <button mat-dialog-close cdkFocusInitial (click)="onAbortClick()" mat-icon-button
        [attr.aria-label]="'common.actions.abort' | transloco" class="action-close"><mat-icon>close</mat-icon></button>
    <button mat-icon-button type="button" (click)="help.open('editNote')"
        [attr.aria-label]="'common.actions.help' | transloco">
        <mat-icon>help</mat-icon>
    </button>
    @if (data.note.note !== '' || data.note.multimedia.type !== 'undefined') {
    <button (click)="onApplyClick()" mat-icon-button
        [attr.aria-label]="'common.actions.apply' | transloco"><mat-icon>send</mat-icon></button>
    }
</mat-dialog-actions>
