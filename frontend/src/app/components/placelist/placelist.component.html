<h2 mat-dialog-title class="dialog-title">
    <mat-icon class="dialog-title__icon" aria-hidden="true">place</mat-icon>
    <span class="dialog-title__text">{{ 'common.menu.myPlaces' | transloco }}</span>
</h2>

<mat-dialog-content class="place-dialog-content">
    <div class="place-scroll">
        @if (!hasPlaces()) {
        <div class="empty-state">
            <p class="empty-text">{{ 'common.placeList.addFirstPlace' | transloco }}</p>
        </div>
        } @else {
        <div class="content">
            @for (place of placesSignal(); track place.id){
            <mat-card class="place-tile">
                <div class="tile-header"
                    [style.--place-header-bg-image]="getPlaceHeaderBackgroundImage(place)"
                    [style.--place-header-bg-opacity]="getPlaceHeaderBackgroundOpacity(place)">
                    <div class="place-identity">
                        @if (place.base64Avatar) {
                        <img class="avatar" [src]="place.base64Avatar"
                            [attr.alt]="place.name ? ('common.placeList.avatarAltName' | transloco:{ name: place.name }) : ('common.placeList.avatarAltFallback' | transloco)" />
                        } @else {
                        <mat-icon>{{ place.icon || 'location' }}</mat-icon>
                        }
                        @if (place.name) {
                        <span class="name">{{ place.name }}</span>
                        } @else {
                        <span class="name">{{ 'common.placeList.nameFallback' | transloco }}</span>
                        }
                    </div>
                    @if (place.placeBackgroundAttribution ?? place.avatarAttribution; as attribution) {
                    @if (attribution.source === 'unsplash') {
                    <div class="unsplash-badge">
                        <a class="unsplash-badge__link" [href]="attribution.photoUrl" target="_blank" rel="noopener">
                            {{ 'common.avatarAttribution.creatorLink' | transloco:{ name: attribution.authorName } }}
                        </a>
                    </div>
                    }
                    }
                </div>
                <mat-card-actions class="tile-actions">
                    <div class="tile-actions__left">
                        @if (userService.hasJwt()) {
                        <button mat-mini-fab color="'active-button'"
                            [attr.aria-label]="'common.placeList.deleteAria' | transloco" (click)="deletePlace(place)">
                            <mat-icon>delete_forever</mat-icon>
                        </button>
                        }
                    </div>
                    <div class="tile-actions__right">
                        @if(place.pinned) {
                        <button mat-mini-fab color="'active-button'"
                            [attr.aria-label]="'common.placeList.unpinAria' | transloco" (click)="unpinPlace(place)">
                            <mat-icon>keep_off</mat-icon>
                        </button>
                        } @else {
                        <button mat-mini-fab color="'active-button'"
                            [attr.aria-label]="'common.placeList.pinAria' | transloco" (click)="pinPlace(place)">
                            <mat-icon>keep</mat-icon>
                        </button>
                        }
                        <button mat-mini-fab color="'active-button'" (click)="openTileList(place)"
                            [attr.aria-label]="tileListAriaLabel(place)">
                            <mat-icon>dashboard</mat-icon>
                        </button>
                        <button mat-mini-fab color="'active-button'"
                            [attr.aria-label]="'common.placeList.flyToAria' | transloco" (click)="flyTo(place)">
                            <mat-icon>place</mat-icon>
                        </button>
                        <button mat-mini-fab color="'active-button'" [matMenuTriggerFor]="placeMenu"
                            [attr.aria-label]="'common.actions.more' | transloco">
                            <mat-icon>more_horiz</mat-icon>
                        </button>
                        <mat-menu #placeMenu="matMenu" panelClass="accent-menu">
                            @if (userService.hasJwt()) {
                            <button mat-menu-item (click)="editPlace(place)">
                                <mat-icon>settings_account_box</mat-icon>
                                <span>{{ 'common.placeList.editAria' | transloco }}</span>
                            </button>
                            }
                            <button mat-menu-item (click)="openPlaceInMaps(place)">
                                <mat-icon>map</mat-icon>
                                <span>{{ 'common.placeList.openInMaps' | transloco }}</span>
                            </button>
                            @if (!subscriptionError && userService.hasJwt()) {
                            @if (place.subscribed) {
                            <button mat-menu-item (click)="handleSubscription(place)">
                                <mat-icon>bookmark_remove</mat-icon>
                                <span>{{ 'common.placeList.unsubscribeAria' | transloco }}</span>
                            </button>
                            } @else {
                            <button mat-menu-item (click)="handleSubscription(place)">
                                <mat-icon>bookmark_add</mat-icon>
                                <span>{{ 'common.placeList.subscribeAria' | transloco }}</span>
                            </button>
                            }
                            }
                        </mat-menu>
                    </div>
                </mat-card-actions>
            </mat-card>
            }
        </div>
        }
    </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
    <button mat-icon-button class="action-close" (click)="goBack()"
        [attr.aria-label]="'common.actions.close' | transloco">
        <mat-icon>close</mat-icon>
    </button>
    @if (userService.hasJwt()) {
    <button mat-icon-button color="primary" [attr.aria-label]="'common.placeList.addPlaceAria' | transloco"
        (click)="addPlace()">
        <mat-icon>add_location</mat-icon>
    </button>
    }
</mat-dialog-actions>
