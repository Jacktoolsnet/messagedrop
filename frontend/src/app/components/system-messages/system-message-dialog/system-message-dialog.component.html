<h2 mat-dialog-title>System messages</h2>
<mat-dialog-content>
  <div class="dialog-content">
    <div class="filter-group">
      <mat-button-toggle-group [hideSingleSelectionIndicator]="true" class="filter-toggle-group" exclusive
        [value]="currentFilter()" (change)="handleFilterChange($event)" aria-label="Filter system messages">
        <mat-button-toggle value="unread">
          <mat-icon class="material-symbols-outlined">mark_email_unread</mat-icon>
          <span>Unread</span>
        </mat-button-toggle>
        <mat-button-toggle value="read">
          <mat-icon class="material-symbols-outlined">drafts</mat-icon>
          <span>Read</span>
        </mat-button-toggle>
        <mat-button-toggle value="all">
          <mat-icon class="material-symbols-outlined">all_inbox</mat-icon>
          <span>All</span>
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    @if (loading()) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }

    <div class="notifications-wrapper">
      <div class="notification-list">
        @if (notifications().length === 0 && !loading()) {
          <div class="empty-state">
            No system messages in this view.
          </div>
        } @else {
          <mat-nav-list>
            @for (notification of notifications(); track trackByUuid($index, notification)) {
              <a mat-list-item
                 class="notification-item"
                 (click)="selectNotification(notification)"
                 [class.active]="selectedNotification()?.uuid === notification.uuid">
                <mat-icon class="material-symbols-outlined"
                          matListItemIcon>
                  {{ notification.status === 'unread' ? 'notifications_active' : 'notifications' }}
                </mat-icon>
                <div matLine class="notification-item__title">
                  <span>{{ notification.title }}</span>
                  <span class="notification-item__timestamp">
                    {{ (notification.createdAt * 1000) | date : 'short' }}
                  </span>
                </div>
                <div matLine class="notification-item__summary">
                  {{ getSummary(notification) }}
                </div>
                <div matListItemMeta class="notification-item__actions">
                  <button mat-button color="primary"
                          (click)="$event.stopPropagation(); selectNotification(notification)">
                    <mat-icon class="material-symbols-outlined" aria-hidden="true">visibility</mat-icon>
                    View details
                  </button>
                  <button mat-stroked-button color="accent"
                          [disabled]="notification.status !== 'unread'"
                          (click)="markNotificationAsRead(notification, $event)">
                    <mat-icon class="material-symbols-outlined" aria-hidden="true">done_all</mat-icon>
                    Mark as read
                  </button>
                </div>
              </a>
            }
          </mat-nav-list>
        }
      </div>

      <div class="notification-detail">
        @if (selectedNotification(); as detail) {
        <div class="notification-detail__header">
          <h3>{{ detail.title }}</h3>
          <span class="notification-status" [class.unread]="detail.status === 'unread'"
            [class.read]="detail.status === 'read'" [class.archived]="detail.status === 'archived'">
            {{ detail.status }}
          </span>
        </div>

        <div class="notification-detail__meta">
          <span>Received {{ (detail.createdAt * 1000) | date : 'medium' }}</span>
          @if (detail.readAt) {
          <span>Read {{ (detail.readAt * 1000) | date : 'medium' }}</span>
          }
        </div>

        <p class="notification-detail__body">
          {{ detail.body }}
        </p>

        @if (detail.metadata?.reasonText) {
        <p class="notification-detail__reason">
          Reason: {{ detail.metadata?.reasonText }}
        </p>
        }

        @if (detail.metadata?.dsa?.statusUrl) {
        <button mat-stroked-button color="primary" (click)="openStatusLink(detail.metadata?.dsa?.statusUrl, $event)">
          View case details
        </button>
        }

        } @else {
          <div class="empty-state">
            Select a system message to see details.
          </div>
        }
      </div>
    </div>
  </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Close</button>
</mat-dialog-actions>
