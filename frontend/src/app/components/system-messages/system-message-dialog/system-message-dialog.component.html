<h2 mat-dialog-title class="dialog-title">
  @if (selectedNotification(); as detail) {
  <div class="dialog-title">
    <button mat-icon-button class="back-button" (click)="backToList()"
      [attr.aria-label]="'common.systemMessages.backAria' | transloco">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="dialog-title__text">{{ detail.title }}</span>
  </div>
  } @else {
  <div class="dialog-title">
    <button mat-icon-button class="back-button" (click)="reloadNotifications()"
      [attr.aria-label]="'common.systemMessages.refreshAria' | transloco">
      <mat-icon>refresh</mat-icon>
    </button>
    <span class="dialog-title__text">{{ 'common.systemMessages.title' | transloco }}</span>
  </div>
  }
</h2>

<mat-dialog-content>
  <div class="dialog-content">
    @if (!selectedNotification()) {
    <div class="filter-group">
      <mat-button-toggle-group [hideSingleSelectionIndicator]="true" class="filter-toggle-group" exclusive
        [value]="currentFilter()" (change)="handleFilterChange($event)"
        [attr.aria-label]="'common.systemMessages.filterAria' | transloco">
        <mat-button-toggle value="unread">
          <mat-icon>mark_email_unread</mat-icon>
          <span>{{ 'common.systemMessages.filters.unread' | transloco }}</span>
        </mat-button-toggle>
        <mat-button-toggle value="read">
          <mat-icon>drafts</mat-icon>
          <span>{{ 'common.systemMessages.filters.read' | transloco }}</span>
        </mat-button-toggle>
        <mat-button-toggle value="all">
          <mat-icon>all_inbox</mat-icon>
          <span>{{ 'common.systemMessages.filters.all' | transloco }}</span>
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
    }

    @if (loading()) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }

    @if (selectedNotification(); as detail) {
    <div class="detail-view">
      <div class="detail-tile-grid">
        <div class="detail-tile detail-meta-item detail-meta-case">
          <span class="detail-meta-item__label">{{ 'common.systemMessages.detail.caseId' | transloco }}</span>
          <span class="detail-meta-item__value">
            {{ detail.metadata?.dsa?.caseId ?? ('common.systemMessages.notAvailable' | transloco) }}
          </span>
        </div>
        <div class="detail-tile detail-meta-item detail-meta-actions">
          <span class="detail-meta-item__label">{{ 'common.systemMessages.detail.actions' | transloco }}</span>
          <div class="detail-actions" role="group" [attr.aria-label]="'common.systemMessages.caseActionsAria' | transloco">
            @if (detail.metadata?.dsa?.statusUrl) {
            <button mat-icon-button color="primary" [matTooltip]="'common.systemMessages.openCaseDetails' | transloco"
              (click)="openStatusLink(detail.metadata?.dsa?.statusUrl, $event)"
              [attr.aria-label]="'common.systemMessages.openCaseDetails' | transloco">
              <mat-icon>open_in_new</mat-icon>
            </button>
            }
            <button mat-icon-button color="accent"
              [matTooltip]="(detail.status === 'unread' ? 'common.systemMessages.markAsRead' : 'common.systemMessages.markAsUnread') | transloco"
              (click)="detail.status === 'unread' ? markNotificationAsRead(detail, $event) : markNotificationAsUnread(detail, $event)"
              [attr.aria-label]="'common.systemMessages.toggleReadState' | transloco">
              <mat-icon>
                {{ detail.status === 'unread' ? 'mark_email_read' : 'mark_email_unread' }}
              </mat-icon>
            </button>
            <button mat-icon-button color="warn" [matTooltip]="'common.systemMessages.deleteMessage' | transloco"
              (click)="confirmDelete(detail, $event)" [attr.aria-label]="'common.systemMessages.deleteMessage' | transloco">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
      <div class="detail-tile detail-body">
        <span class="detail-meta-item__label">{{ 'common.systemMessages.detail.message' | transloco }}</span>
        <span class="detail-meta-item__value">{{ detail.body }}</span>
      </div>

      <div class="detail-tile-grid">
        @if (detail.metadata?.reasonText) {
        <div class="detail-tile detail-meta-item">
          <span class="detail-meta-item__label">{{ 'common.systemMessages.detail.reason' | transloco }}</span>
          <span class="detail-meta-item__value">{{ detail.metadata?.reasonText }}</span>
        </div>
        }
        @if (detail.metadata?.category) {
        <div class="detail-tile detail-meta-item">
          <span class="detail-meta-item__label">{{ 'common.systemMessages.detail.category' | transloco }}</span>
          <span class="detail-meta-item__value">{{ detail.metadata?.category }}</span>
        </div>
        }
        @if (detail.metadata?.reportedContentType) {
        <div class="detail-tile detail-meta-item">
          <span class="detail-meta-item__label">{{ 'common.systemMessages.detail.contentType' | transloco }}</span>
          <span class="detail-meta-item__value">{{ detail.metadata?.reportedContentType }}</span>
        </div>
        }
        <div class="detail-tile detail-meta-item detail-meta-status">
          <span class="detail-meta-item__label">{{ 'common.systemMessages.detail.status' | transloco }}</span>
          <div class="detail-status-wrapper">
            <span class="detail-status detail-status-text" [class.unread-text]="detail.status === 'unread'">
              {{ ('common.systemMessages.status.' + detail.status) | transloco }}
            </span>
            <span class="detail-meta-item__note">{{ (detail.createdAt * 1000) | date : 'medium' }}</span>
          </div>
        </div>
      </div>
    </div>
    } @else {
    <mat-nav-list class="notification-list">
      @if (notifications().length === 0 && !loading()) {
      <div class="empty-state">
        {{ 'common.systemMessages.empty' | transloco }}
      </div>
      } @else {
      @for (notification of notifications(); track trackByUuid($index, notification)) {
      <a mat-list-item class="notification-item" role="button" tabindex="0"
        (click)="selectNotification(notification, $event)" (keyup.enter)="selectNotification(notification, $event)"
        (keyup.space)="selectNotification(notification, $event)"
        [class.active]="selectedNotification()?.uuid === notification.uuid">
        <mat-icon matListItemIcon>
          {{ notification.status === 'unread' ? 'notifications_active' : 'notifications' }}
        </mat-icon>
        <div matLine class="notification-item__title">{{ notification.title }}</div>
        <div matLine class="notification-item__timestamp">
          {{ (notification.createdAt * 1000) | date : 'medium' }}
        </div>
        <div matListItemMeta class="notification-item__actions">
          @if (notification.metadata?.dsa?.statusUrl) {
          <button mat-icon-button color="primary" [matTooltip]="'common.systemMessages.openCaseDetails' | transloco"
            (click)="openStatusLink(notification.metadata?.dsa?.statusUrl, $event)"
            [attr.aria-label]="'common.systemMessages.openCaseDetails' | transloco">
            <mat-icon>open_in_new</mat-icon>
          </button>
          }
          @if (notification.status === 'unread') {
          <button mat-icon-button color="accent" [matTooltip]="'common.systemMessages.markAsRead' | transloco"
            (click)="markNotificationAsRead(notification, $event)"
            [attr.aria-label]="'common.systemMessages.markAsRead' | transloco">
            <mat-icon>mark_email_read</mat-icon>
          </button>
          } @else {
          <button mat-icon-button color="accent" [matTooltip]="'common.systemMessages.markAsUnread' | transloco"
            (click)="markNotificationAsUnread(notification, $event)"
            [attr.aria-label]="'common.systemMessages.markAsUnread' | transloco">
            <mat-icon>mark_email_unread</mat-icon>
          </button>
          }
          <button mat-icon-button color="warn" [matTooltip]="'common.systemMessages.deleteMessage' | transloco"
            (click)="confirmDelete(notification, $event)"
            [attr.aria-label]="'common.systemMessages.deleteMessage' | transloco">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </a>
      }
      }
    </mat-nav-list>
    }
  </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
  <button (click)="close()" mat-icon-button [attr.aria-label]="'common.actions.close' | transloco" class="action-close"><mat-icon>close</mat-icon></button>
  @if (!selectedNotification()) {
  <button color="warn" [matTooltip]="'common.systemMessages.deleteAll' | transloco" (click)="confirmDeleteAll($event)" [attr.aria-label]="'common.systemMessages.deleteAll' | transloco" [disabled]="notifications().length === 0" mat-icon-button><mat-icon>delete_sweep</mat-icon></button>
  }
</mat-dialog-actions>
