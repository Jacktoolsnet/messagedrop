<h2 mat-dialog-title class="dialog-title">
    <mat-icon class="dialog-title__icon" aria-hidden="true">contacts</mat-icon>
    <span class="dialog-title__text">{{ 'common.menu.myContacts' | transloco }}</span>
</h2>

<mat-dialog-content class="contact-dialog-content">
    <div class="contact-scroll">
        @if (contactsSignal().length === 0) {
        <div class="empty-state">
            <p class="empty-text">{{ 'common.contact.connect.start' | transloco }}</p>
        </div>
        } @else {
        <div class="content">
            @for (contact of contactsSignal(); track contact.id){
            <mat-card class="contact-tile">
                <div class="tile-header"
                    [style.--contact-header-bg-image]="getContactHeaderBackgroundImage(contact)"
                    [style.--contact-header-bg-opacity]="getContactHeaderBackgroundOpacity(contact)">
                    <div class="contact-identity">
                        <span class="avatar-badge" [matBadge]="getUnreadBadge(contact.id)"
                            [matBadgeHidden]="getUnreadBadge(contact.id) === ''" matBadgeOverlap="true"
                            matBadgeColor="warn">
                            @if (contact.base64Avatar) {
                            <img class="avatar" [src]="contact.base64Avatar"
                                [attr.alt]="contact.name ? ('common.contact.profile.avatarAltName' | transloco:{ name: contact.name }) : ('common.contact.profile.avatarAlt' | transloco)" />
                            } @else {
                            <mat-icon>person</mat-icon>
                            }
                        </span>
                        <span class="name">{{ contact.name || ('common.contact.list.nameFallback' | transloco) }}</span>
                    </div>
                    @if (contact.chatBackgroundAttribution ?? contact.avatarAttribution; as attribution) {
                    @if (attribution.source === 'unsplash') {
                    <div class="unsplash-badge">
                        <a class="unsplash-badge__link" [href]="attribution.photoUrl" target="_blank" rel="noopener">
                            {{ 'common.avatarAttribution.creatorLink' | transloco:{ name: attribution.authorName } }}
                        </a>
                    </div>
                    }
                    }
                </div>
                <mat-card-actions class="tile-actions">
                    <div class="tile-actions__left">
                        @if (userService.hasJwt()) {
                        <button mat-mini-fab color="secondary"
                            [attr.aria-label]="'common.contact.delete.title' | transloco"
                            (click)="deleteContact(contact)">
                            <mat-icon>delete_forever</mat-icon>
                        </button>
                        }
                    </div>
                    <div class="tile-actions__right">
                        @if (contact.pinned) {
                        <button mat-mini-fab color="'active-button'"
                            [attr.aria-label]="'common.contact.list.unpinAria' | transloco"
                            (click)="unpinContact(contact)">
                            <mat-icon>keep_off</mat-icon>
                        </button>
                        } @else {
                        <button mat-mini-fab color="'active-button'"
                            [attr.aria-label]="'common.contact.list.pinAria' | transloco" (click)="pinContact(contact)">
                            <mat-icon>keep</mat-icon>
                        </button>
                        }
                        @if (userService.hasJwt()) {
                        <button mat-mini-fab color="'active-button'"
                            [attr.aria-label]="'common.contact.list.openChatroomAria' | transloco"
                            [matBadge]="getUnreadBadge(contact.id)" [matBadgeHidden]="getUnreadBadge(contact.id) === ''"
                            matBadgeOverlap="true" matBadgeColor="warn" (click)="openContactChatroom(contact)">
                            <mat-icon>forum</mat-icon>
                        </button>
                        }
                        <button mat-mini-fab color="secondary" (click)="openTileList(contact)"
                            [attr.aria-label]="tileListAriaLabel(contact)">
                            <mat-icon>dashboard</mat-icon>
                        </button>
                        <button mat-mini-fab color="secondary" [matMenuTriggerFor]="contactMenu"
                            [attr.aria-label]="'common.actions.more' | transloco">
                            <mat-icon>more_horiz</mat-icon>
                        </button>
                        <mat-menu #contactMenu="matMenu" panelClass="accent-menu">
                            <button mat-menu-item (click)="editContact(contact)">
                                <mat-icon>settings_account_box</mat-icon>
                                <span>{{ 'common.contact.list.editAria' | transloco }}</span>
                            </button>
                            @if (!subscriptionError && userService.hasJwt()) {
                            @if (contact.subscribed) {
                            <button mat-menu-item (click)="subscribe(contact)">
                                <mat-icon>bookmark_remove</mat-icon>
                                <span>{{ 'common.contact.list.unsubscribeAria' | transloco }}</span>
                            </button>
                            } @else {
                            <button mat-menu-item (click)="subscribe(contact)">
                                <mat-icon>bookmark_add</mat-icon>
                                <span>{{ 'common.contact.list.subscribeAria' | transloco }}</span>
                            </button>
                            }
                            }
                        </mat-menu>
                    </div>
                </mat-card-actions>
            </mat-card>
            }
        </div>
        }
    </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
    <button mat-icon-button class="action-close" (click)="goBack()"
        [attr.aria-label]="'common.actions.close' | transloco">
        <mat-icon>close</mat-icon>
    </button>
    @if (userService.hasJwt()) {
    <button mat-icon-button color="primary" [attr.aria-label]="'common.contact.connect.addAria' | transloco"
        [matMenuTriggerFor]="connectionMenu">
        <mat-icon>connect_without_contact</mat-icon>
    </button>
    }
</mat-dialog-actions>

<mat-menu #connectionMenu="matMenu" panelClass="accent-menu">
    <button mat-menu-item (click)="shareConnectId()">
        <mat-icon>share</mat-icon>
        <span>{{ 'common.contact.connect.menuShare' | transloco }}</span>
    </button>
    <button mat-menu-item (click)="openConnectDialog()">
        <mat-icon>link</mat-icon>
        <span>{{ 'common.contact.connect.menuConnectWithId' | transloco }}</span>
    </button>
    <button mat-menu-item (click)="openQrDialog()">
        <mat-icon>qr_code</mat-icon>
        <span>{{ 'common.contact.connect.menuShareQr' | transloco }}</span>
    </button>
    <button mat-menu-item (click)="openScannerDialog()">
        <mat-icon>qr_code_scanner</mat-icon>
        <span>{{ 'common.contact.connect.menuConnectQr' | transloco }}</span>
    </button>
</mat-menu>
