<app-dialog-header
  icon="clinical_notes"
  [title]="'common.tiles.notes.title' | transloco">
</app-dialog-header>

<mat-dialog-content class="note-dialog-content">
    <div class="note-scroll">
        @if (!hasNotes()) {
        <div class="empty-state">
            <p class="empty-text">{{ 'common.tiles.notes.empty' | transloco }}</p>
        </div>
        } @else {
        <div class="content">
            @for (note of sortedNotes(); track note.id) {
            <mat-card class="item" [class.has-badge]="!!note.timestamp" appMasonryItem>
                @if (note.timestamp) {
                <div class="timestamp-box">{{ note.timestamp | date:'medium' }}</div>
                }
                <mat-card-content (click)="editNote(note)">
                    <div class="message-content">
                        <app-showmultimedia [multimedia]="note.multimedia"></app-showmultimedia>
                        <app-showmessage [message]="note.note" [style]="note.style"></app-showmessage>
                        @if (note.hashtags?.length) {
                        <div class="hashtag-chip-list" [attr.aria-label]="'common.hashtags.label' | transloco">
                            @for (tag of note.hashtags; track tag) {
                            <span class="hashtag-chip">#{{ tag }}</span>
                            }
                        </div>
                        }
                    </div>
                </mat-card-content>
                <mat-card-actions class="buttonbar">
                    @if (userService.isReady()) {
                    <button mat-mini-fab color="secondary" [attr.aria-label]="'common.noteList.deleteAria' | transloco"
                        (click)="deleteNote(note)">
                        <mat-icon>delete_forever</mat-icon>
                    </button>
                    <button mat-mini-fab color="secondary" [attr.aria-label]="'common.noteList.editAria' | transloco"
                        (click)="editNote(note)">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-mini-fab color="secondary" [attr.aria-label]="'common.noteList.flyToAria' | transloco"
                        (click)="flyTo(note)">
                        <mat-icon>place</mat-icon>
                    </button>
                    <button mat-mini-fab color="secondary" [attr.aria-label]="'common.noteList.navigateAria' | transloco"
                        (click)="navigateToNoteLocation(note)">
                        <mat-icon>assistant_direction</mat-icon>
                    </button>
                    }
                </mat-card-actions>
            </mat-card>
            }
        </div>
        }
    </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
    <button mat-icon-button class="action-close" (click)="goBack()"
        [attr.aria-label]="'common.actions.close' | transloco">
        <mat-icon>close</mat-icon>
    </button>
    <button mat-icon-button type="button" (click)="help.open('noteList')"
        [attr.aria-label]="'common.actions.help' | transloco">
        <mat-icon>help</mat-icon>
    </button>
    <button mat-icon-button color="primary" [attr.aria-label]="'common.noteList.addNoteAria' | transloco"
        (click)="!userService.isReady() ? userService.login(openNoteDialog.bind(this)) : openNoteDialog()">
        <mat-icon>add_notes</mat-icon>
    </button>
</mat-dialog-actions>
