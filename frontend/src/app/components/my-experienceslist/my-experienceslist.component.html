<app-dialog-header
  icon="bookmark_star"
  [title]="'common.menu.myExperiences' | transloco">
</app-dialog-header>

<mat-dialog-content class="experience-dialog-content">
  <div class="experience-scroll">
    @if (!hasBookmarks()) {
      <div class="empty-state">
        <p class="empty-text">{{ 'common.experiences.noResults' | transloco }}</p>
      </div>
    } @else {
      <div class="results" role="list">
        @for (bookmark of visibleBookmarks(); track bookmark.productCode) {
          <mat-card class="experience-tile" role="listitem">
            <div class="tile-header"
              [style.--experience-header-bg-image]="getExperienceHeaderBackgroundImage(bookmark.snapshot)"
              [style.--experience-header-bg-opacity]="getExperienceHeaderBackgroundOpacity(bookmark.snapshot)">
              <div class="identity-badge">
                @if (bookmark.snapshot.avatarUrl) {
                  <img class="avatar" [src]="bookmark.snapshot.avatarUrl"
                    [alt]="bookmark.snapshot.title || bookmark.snapshot.productCode || ''" />
                } @else {
                  <mat-icon>local_activity</mat-icon>
                }
                <div class="identity-text">
                  <span class="name"
                    [attr.title]="bookmark.snapshot.title || bookmark.snapshot.productCode || ''">
                    {{ bookmark.snapshot.title || bookmark.snapshot.productCode || '' }}
                  </span>
                  @if (getDurationLabel(bookmark.snapshot)) {
                    <span class="subtitle">{{ 'common.experiences.durationPrefix' | transloco }}
                      {{ getDurationLabel(bookmark.snapshot) }}</span>
                  }
                </div>
              </div>
              <div class="viator-badge">
                <span class="viator-badge__text">{{ 'common.experiences.sourceViator' | transloco }}</span>
                <a class="viator-badge__link" href="https://www.viator.com/?pid=P00285785&mcid=42383&medium=link"
                  target="_blank" rel="noopener">Viator</a>
              </div>
              @if (getRatingLabel(bookmark.snapshot)) {
                <div class="rating-badge">â˜… {{ getRatingLabel(bookmark.snapshot) }}</div>
              }
            </div>
            <mat-card-content class="experience-content">
              <p class="experience-description">
                {{ bookmark.snapshot.description }}
              </p>
            </mat-card-content>
            <mat-card-actions class="tile-actions">
              <div class="tile-actions__left">
                <button mat-mini-fab color="primary" type="button" (click)="openDetails(bookmark.snapshot)"
                  [attr.aria-label]="'common.experiences.showMore' | transloco">
                  <mat-icon>expand_content</mat-icon>
                </button>
                <button mat-mini-fab color="secondary" type="button" (click)="onToggleBookmark(bookmark.snapshot, $event)"
                  [attr.aria-label]="isBookmarked(bookmark.snapshot)
                    ? ('common.experiences.saveRemovedTitle' | transloco)
                    : ('common.experiences.saveTitle' | transloco)">
                  <mat-icon>{{ isBookmarked(bookmark.snapshot) ? 'bookmark_remove' : 'bookmark_add' }}</mat-icon>
                </button>
                <button mat-mini-fab color="primary" type="button" (click)="showOnMap(bookmark.snapshot)"
                  [disabled]="!hasDestination(bookmark.snapshot)"
                  [attr.aria-label]="'common.experiences.showOnMap' | transloco">
                  <mat-icon>place</mat-icon>
                </button>
                <button mat-mini-fab color="primary" type="button" (click)="openTileList(bookmark.snapshot)"
                  [attr.aria-label]="tileListAriaLabel(bookmark.snapshot)">
                  <mat-icon>dashboard</mat-icon>
                </button>
              </div>
              <div class="tile-actions__right">
                <button mat-mini-fab color="primary" type="button" (click)="openInMaps(bookmark.snapshot)"
                  [disabled]="!hasDestination(bookmark.snapshot)"
                  [attr.aria-label]="'common.experiences.openInMaps' | transloco">
                  <mat-icon>map</mat-icon>
                </button>
                <button mat-raised-button color="primary" class="open-viator-button" type="button"
                  (click)="onOpen(bookmark.snapshot)"
                  [disabled]="!bookmark.snapshot.productUrl"
                  [attr.aria-label]="'common.experiences.openOn' | transloco : { provider: 'Viator' }">
                  <mat-icon>shopping_cart</mat-icon>
                  <span class="open-viator-label">
                    {{ getPriceLabel(bookmark.snapshot) || ('common.experiences.openOn' | transloco : { provider: 'Viator' }) }}
                  </span>
                </button>
              </div>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
  <button mat-dialog-close mat-icon-button class="action-close" [attr.aria-label]="'common.actions.close' | transloco">
    <mat-icon>close</mat-icon>
  </button>
  <button mat-icon-button type="button" (click)="help.open('myExperienceList')"
    [attr.aria-label]="'common.actions.help' | transloco">
    <mat-icon>help</mat-icon>
  </button>
  @if (userService.hasJwt()) {
  @if (visibleBookmarks().length > 1) {
  <button mat-icon-button color="primary" (click)="openSortDialog()"
    [attr.aria-label]="'common.experiences.sortAria' | transloco">
    <mat-icon>swap_vert</mat-icon>
  </button>
  }
  }
</mat-dialog-actions>
