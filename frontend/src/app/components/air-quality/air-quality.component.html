<h2 mat-dialog-title class="dialog-title">
    <span class="dialog-title__text">
        @if (locationName$ | async; as locationName) {
            {{ 'weather.airQuality.headerFor' | transloco:{ category: getCategoryLabel(selectedCategory), location: locationName } }}
        } @else {
            {{ 'weather.airQuality.header' | transloco:{ category: getCategoryLabel(selectedCategory) } }}
        }
    </span>
</h2>

<mat-dialog-content #dialogContent class="air-quality-dialog-content">
    <div class="air-quality-scroll">
    @if (airQualitySig()) {

    <mat-button-toggle-group [hideSingleSelectionIndicator]="true" class="day-toggle-group" [value]="selectedDayIndex"
        (change)="onDayChange($event.value)">
        @for (dayLabel of dayLabels(); track dayLabel; let i = $index) {
        <mat-button-toggle [value]="i">
            {{ dayLabel }}
        </mat-button-toggle>
        }
    </mat-button-toggle-group>

    <div class="tile-scroll" [class.detail-open]="selectedTile">
        @if (!selectedTile) {
        <div class="tile-grid">
            @for (tile of tileValues(); track tile.label) {
            <button type="button" class="tile" [style.color]="tile.color" (click)="onTileClick(tile)">
                <div class="tile-title">{{ tile.label }}</div>
                <div class="tile-icon-wrapper">
                    <mat-icon class="tile-icon">{{ tile.icon }}</mat-icon>
                </div>
                <div class="tile-value">
                    {{ tile.value }} {{ tile.unit }}
                </div>
                @if (tile.levelText) {
                <div class="tile-level">{{ tile.levelText }}</div>
                }
                @if (tile.minMax) {
                <div class="tile-minmax">{{ tile.minMax.min }} - {{ tile.minMax.max }}</div>
                }
            </button>
            }
        </div>
        } @else {
        <app-air-quality-detail [tile]="selectedTile" [selectedDayIndex]="selectedDayIndex" [selectedHour]="selectedHour">
        </app-air-quality-detail>
        }
    </div>

    <div class="hour-slider">
        <mat-slider min="0" max="23" step="1" thumbLabel tickInterval="1" (input)="onHourChange()">
            <input matSliderThumb [(ngModel)]="selectedHour">
        </mat-slider>
        @if (!selectedTile) {
        <div class="selected-hour">{{ 'weather.airQuality.selectedHour' | transloco:{ hour: selectedHour } }}</div>
        }
    </div>

    @if (selectedTile) {
    <div class="tile-nav-buttons">
        <button mat-mini-fab (click)="selectPreviousTile()" [disabled]="tileIndex === 0">
            <mat-icon>chevron_left</mat-icon>
        </button>
        <button mat-mini-fab (click)="clearSelectedTile()">
            <mat-icon>close</mat-icon>
        </button>
        <button mat-mini-fab (click)="selectNextTile()" [disabled]="tileIndex === allKeys().length - 1">
            <mat-icon>chevron_right</mat-icon>
        </button>
    </div>
    }

    @if (!selectedTile) {
    <mat-button-toggle-group [hideSingleSelectionIndicator]="true" class="category-toggle-group"
        [value]="selectedCategory" (change)="onCategoryToggle($event.value)" multiple="false">

        @for (category of categoryModes; track category) {
            <mat-button-toggle [value]="category" [matTooltip]="getCategoryLabel(category)">
            <mat-icon>
                {{ getCategoryIcon(category) }}
            </mat-icon>
        </mat-button-toggle>
        }

    </mat-button-toggle-group>
    }
    }

    <div class="data-source">
        {{ 'weather.airQuality.dataSource' | transloco }}
        <a href="https://open-meteo.com/" target="_blank" rel="noopener">open-meteo.com</a>.
    </div>
    </div>
</mat-dialog-content>

<mat-dialog-actions class="sticky-actions" align="end">
    <button mat-dialog-close mat-icon-button class="action-close" cdkFocusInitial
        [attr.aria-label]="'common.actions.close' | transloco">
        <mat-icon>close</mat-icon>
    </button>
    <button mat-icon-button type="button" (click)="help.open('airQuality')"
        [attr.aria-label]="'common.actions.help' | transloco">
        <mat-icon>help</mat-icon>
    </button>
</mat-dialog-actions>
