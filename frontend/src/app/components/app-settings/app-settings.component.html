<h2 mat-dialog-title>App settings</h2>
<mat-dialog-content>
  <div class="platform-tile-container">
    <div class="platform-tile theme-settings-tile">
      <div class="theme-settings-header">
        <mat-icon>palette</mat-icon>
        <div>
          <h3>Theme & appearance</h3>
          <p class="theme-settings-subtitle">Choose colors and light/dark behavior.</p>
        </div>
      </div>

      <mat-form-field appearance="fill" class="theme-select">
        <mat-label>Theme</mat-label>
        <mat-select [value]="appSettings.defaultTheme" (selectionChange)="setTheme($event.value)">
          @for (theme of availableThemes; track theme) {
            <mat-option [value]="theme">
              {{ theme | titlecase }}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-button-toggle-group [hideSingleSelectionIndicator]="true" [value]="appSettings.themeMode"
        (change)="setThemeMode($event.value)" class="theme-toggle-group" exclusive
        aria-label="Theme mode toggle">
        <mat-button-toggle value="light">
          <mat-icon>light_mode</mat-icon>
          Light
        </mat-button-toggle>
        <mat-button-toggle value="dark">
          <mat-icon>dark_mode</mat-icon>
          Dark
        </mat-button-toggle>
        <mat-button-toggle value="system">
          <mat-icon>settings</mat-icon>
          System
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    @if(showDetectLocationOnStart){
      <div class="platform-tile">
        <app-enable-location (enabledChange)="setDetectLocationOnStart($event)"></app-enable-location>
      </div>
    }
    @if(storagePersistenceSupported){
      <div class="platform-tile storage-persistence-tile">
        <div class="storage-persistence-header">
          <mat-icon>inventory_2</mat-icon>
          <div>
            <h3>Persistent storage</h3>
            <p class="storage-persistence-subtitle">Keeps local data safe from automatic cleanup.</p>
          </div>
        </div>
        <p class="storage-persistence-note">
          When available, we ask the browser to keep IndexedDB data permanently.
          Ideal for offline usage or large message archives.
        </p>
        <mat-slide-toggle color="primary" [checked]="appSettings.persistStorage"
          (change)="onStoragePersistenceToggle($event)" [disabled]="storagePersistenceBusy">
          Protect local data
        </mat-slide-toggle>
        @if(storagePersistenceBusy){
          <small class="storage-persistence-hint">Applying preference ...</small>
        }
        @if(storagePersistenceWarning){
          <p class="storage-persistence-warning">{{ storagePersistenceWarning }}</p>
        }
      </div>
    }
  </div>

  <mat-chip-set class="version-chipset">
    <mat-chip appearance="outlined" color="primary" disableRipple>
      Version {{ versionInfo.semver }}-{{ versionInfo.build }}-{{ versionInfo.commit }}-{{ versionInfo.timestamp
      }}
    </mat-chip>
  </mat-chip-set>

  <mat-dialog-actions>
    <button mat-button mat-dialog-close cdkFocusInitial (click)="onCloseClick()">Close</button>
  </mat-dialog-actions>
